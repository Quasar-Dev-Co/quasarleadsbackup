graph TD
    %% Main Email Response System Flow
    A[ðŸ“§ IMAP Service] --> B[ðŸ“¥ Email Fetch]
    B --> C[ðŸ” Parse & Extract]
    C --> D[âœ… Validate Fields]
    D --> E[ðŸ‘¤ Find/Create Lead]
    E --> F[ðŸ’¾ Save to Database]
    F --> G[ðŸ“Š Update Frontend]
    
    G --> H[ðŸ‘† User Clicks Generate]
    H --> I[ðŸ¤– Load AI Settings]
    I --> J[ðŸ”— Call OpenAI API]
    J --> K[âœï¸ Generate Response]
    K --> L[ðŸ’¾ Save AI Response]
    L --> M[ðŸ“ Show in Editor]
    
    M --> N[ðŸ‘† User Reviews & Edits]
    N --> O[ðŸ“¤ Prepare Email]
    O --> P[ðŸ“§ Send via SMTP]
    P --> Q{âœ… Success?}
    Q -->|Yes| R[âœ… Update Status to Sent]
    Q -->|No| S[âŒ Log Error]
    R --> T[ðŸ“Š Update Lead Status]
    S --> U[âš ï¸ Mark as Failed]
    
    %% AI Generation Process
    V[ðŸ“§ Incoming Email] --> W[âš™ï¸ Load AI Settings]
    W --> X[ðŸ“ Configured Prompt]
    X --> Y[ðŸ¤– OpenAI GPT-4]
    Y --> Z[âœï¸ Generate Response]
    Z --> AA[âœ… Validate Quality]
    AA --> BB[ðŸ’¾ Save to DB]
    
    %% Email States
    CC[ðŸ“¨ UNREAD] --> DD[âš™ï¸ PROCESSING]
    DD --> EE[âœ… RESPONDED]
    EE --> FF[ðŸ“ ARCHIVED]
    
    %% Frontend Flow
    GG[ðŸ–¥ï¸ Dashboard Loads] --> HH[ðŸ“‹ Display Email List]
    HH --> II[ðŸ‘† User Selects Email]
    II --> JJ[ðŸ‘ï¸ Preview Dialog]
    JJ --> KK[ðŸ¤– Generate Response]
    KK --> LL[âœï¸ Edit & Send]
    
    %% Settings Flow
    MM[âš™ï¸ Settings Panel] --> NN[ðŸ“ Configure AI]
    NN --> OO[âœ… Validate Settings]
    OO --> PP[ðŸ’¾ Save to Database]
    
    %% Error Handling
    QQ[âŒ Error Occurs] --> RR[ðŸ“ Log Error]
    RR --> SS[ðŸ”„ Retry or Fail]
    
    %% Performance
    TT[ðŸ“Š Track Metrics] --> UU[ðŸ“ˆ Calculate Stats]
    UU --> VV[ðŸ’¾ Store Analytics]
    VV --> WW[ðŸ“Š Display Dashboard]
    
    %% System Integration
    XX[ðŸ“§ IMAP Service] --> YY[ðŸ”§ Email Processing API]
    YY --> ZZ[ðŸ–¥ï¸ Frontend Interface]
    ZZ --> AAA[ðŸ¤– AI Generation]
    AAA --> BBB[ðŸ’¾ Database Storage]
    BBB --> CCC[ðŸ“§ SMTP Service]
    CCC --> DDD[ï¿½ï¿½ Lead Management] 